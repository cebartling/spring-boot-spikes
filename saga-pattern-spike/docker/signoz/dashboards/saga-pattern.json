{
  "title": "Saga Pattern Monitoring",
  "description": "Dashboard for monitoring saga execution, step latency, compensation rates, and overall saga health",
  "tags": ["saga", "observability", "spring-boot"],
  "version": "v4",
  "variables": {
    "service": {
      "name": "service",
      "type": "QUERY",
      "queryValue": "SELECT DISTINCT service_name FROM signoz_metrics.time_series_v4 WHERE metric_name = 'saga_started_total'",
      "customValue": "sagapattern",
      "multiSelect": false,
      "showALLOption": false
    }
  },
  "layout": [
    {"i": "row-overview", "x": 0, "y": 0, "w": 12, "h": 1},
    {"i": "saga-throughput", "x": 0, "y": 1, "w": 6, "h": 3},
    {"i": "saga-success-rate", "x": 6, "y": 1, "w": 3, "h": 3},
    {"i": "saga-compensation-rate", "x": 9, "y": 1, "w": 3, "h": 3},
    {"i": "row-duration", "x": 0, "y": 4, "w": 12, "h": 1},
    {"i": "saga-duration-histogram", "x": 0, "y": 5, "w": 6, "h": 3},
    {"i": "step-duration", "x": 6, "y": 5, "w": 6, "h": 3},
    {"i": "row-steps", "x": 0, "y": 8, "w": 12, "h": 1},
    {"i": "step-completed", "x": 0, "y": 9, "w": 6, "h": 3},
    {"i": "step-failed", "x": 6, "y": 9, "w": 6, "h": 3},
    {"i": "row-compensation", "x": 0, "y": 12, "w": 12, "h": 1},
    {"i": "compensation-executed", "x": 0, "y": 13, "w": 12, "h": 3}
  ],
  "widgets": [
    {
      "id": "row-overview",
      "title": "Saga Overview",
      "description": "",
      "panelTypes": "row",
      "query": {}
    },
    {
      "id": "saga-throughput",
      "title": "Saga Throughput",
      "description": "Rate of sagas started, completed, and compensated over time",
      "panelTypes": "graph",
      "opacity": "1",
      "isStacked": false,
      "nullZeroValues": "zero",
      "yAxisUnit": "ops",
      "timePreferance": "LAST_15_MIN",
      "query": {
        "queryType": "builder",
        "builder": {
          "queryData": [
            {
              "dataSource": "metrics",
              "queryName": "A",
              "aggregateOperator": "rate",
              "aggregateAttribute": {
                "key": "saga_started_total",
                "type": "Sum",
                "isColumn": true
              },
              "timeAggregation": "rate",
              "spaceAggregation": "sum",
              "filters": {
                "items": [],
                "op": "AND"
              },
              "expression": "A",
              "disabled": false,
              "legend": "Started",
              "stepInterval": 60
            },
            {
              "dataSource": "metrics",
              "queryName": "B",
              "aggregateOperator": "rate",
              "aggregateAttribute": {
                "key": "saga_completed_total",
                "type": "Sum",
                "isColumn": true
              },
              "timeAggregation": "rate",
              "spaceAggregation": "sum",
              "filters": {
                "items": [],
                "op": "AND"
              },
              "expression": "B",
              "disabled": false,
              "legend": "Completed",
              "stepInterval": 60
            },
            {
              "dataSource": "metrics",
              "queryName": "C",
              "aggregateOperator": "rate",
              "aggregateAttribute": {
                "key": "saga_compensated_total",
                "type": "Sum",
                "isColumn": true
              },
              "timeAggregation": "rate",
              "spaceAggregation": "sum",
              "filters": {
                "items": [],
                "op": "AND"
              },
              "expression": "C",
              "disabled": false,
              "legend": "Compensated",
              "stepInterval": 60
            }
          ],
          "queryFormulas": []
        }
      }
    },
    {
      "id": "saga-success-rate",
      "title": "Success Rate",
      "description": "Percentage of sagas completed successfully",
      "panelTypes": "value",
      "opacity": "1",
      "yAxisUnit": "percent",
      "timePreferance": "LAST_15_MIN",
      "thresholds": {
        "thresholds": [
          {"value": 0, "color": "#f44336", "label": "Critical"},
          {"value": 80, "color": "#ff9800", "label": "Warning"},
          {"value": 95, "color": "#4caf50", "label": "Good"}
        ],
        "isEnforcedThresholds": false
      },
      "query": {
        "queryType": "builder",
        "builder": {
          "queryData": [
            {
              "dataSource": "metrics",
              "queryName": "completed",
              "aggregateOperator": "sum",
              "aggregateAttribute": {
                "key": "saga_completed_total",
                "type": "Sum",
                "isColumn": true
              },
              "timeAggregation": "sum",
              "spaceAggregation": "sum",
              "filters": {
                "items": [],
                "op": "AND"
              },
              "expression": "completed",
              "disabled": false,
              "stepInterval": 60
            },
            {
              "dataSource": "metrics",
              "queryName": "started",
              "aggregateOperator": "sum",
              "aggregateAttribute": {
                "key": "saga_started_total",
                "type": "Sum",
                "isColumn": true
              },
              "timeAggregation": "sum",
              "spaceAggregation": "sum",
              "filters": {
                "items": [],
                "op": "AND"
              },
              "expression": "started",
              "disabled": false,
              "stepInterval": 60
            }
          ],
          "queryFormulas": [
            {
              "expression": "(completed / started) * 100",
              "queryName": "F1",
              "disabled": false,
              "legend": "Success Rate %"
            }
          ]
        }
      }
    },
    {
      "id": "saga-compensation-rate",
      "title": "Compensation Rate",
      "description": "Percentage of sagas requiring compensation (lower is better)",
      "panelTypes": "value",
      "opacity": "1",
      "yAxisUnit": "percent",
      "timePreferance": "LAST_15_MIN",
      "thresholds": {
        "thresholds": [
          {"value": 0, "color": "#4caf50", "label": "Good"},
          {"value": 5, "color": "#ff9800", "label": "Warning"},
          {"value": 10, "color": "#f44336", "label": "Critical"}
        ],
        "isEnforcedThresholds": false
      },
      "query": {
        "queryType": "builder",
        "builder": {
          "queryData": [
            {
              "dataSource": "metrics",
              "queryName": "compensated",
              "aggregateOperator": "sum",
              "aggregateAttribute": {
                "key": "saga_compensated_total",
                "type": "Sum",
                "isColumn": true
              },
              "timeAggregation": "sum",
              "spaceAggregation": "sum",
              "filters": {
                "items": [],
                "op": "AND"
              },
              "expression": "compensated",
              "disabled": false,
              "stepInterval": 60
            },
            {
              "dataSource": "metrics",
              "queryName": "started",
              "aggregateOperator": "sum",
              "aggregateAttribute": {
                "key": "saga_started_total",
                "type": "Sum",
                "isColumn": true
              },
              "timeAggregation": "sum",
              "spaceAggregation": "sum",
              "filters": {
                "items": [],
                "op": "AND"
              },
              "expression": "started",
              "disabled": false,
              "stepInterval": 60
            }
          ],
          "queryFormulas": [
            {
              "expression": "(compensated / started) * 100",
              "queryName": "F1",
              "disabled": false,
              "legend": "Compensation Rate %"
            }
          ]
        }
      }
    },
    {
      "id": "row-duration",
      "title": "Duration Metrics",
      "description": "",
      "panelTypes": "row",
      "query": {}
    },
    {
      "id": "saga-duration-histogram",
      "title": "Saga Duration Distribution",
      "description": "Histogram of saga execution times",
      "panelTypes": "graph",
      "opacity": "1",
      "isStacked": false,
      "nullZeroValues": "zero",
      "yAxisUnit": "ms",
      "timePreferance": "LAST_15_MIN",
      "query": {
        "queryType": "builder",
        "builder": {
          "queryData": [
            {
              "dataSource": "metrics",
              "queryName": "A",
              "aggregateOperator": "p50",
              "aggregateAttribute": {
                "key": "saga_duration",
                "type": "Histogram",
                "isColumn": true
              },
              "timeAggregation": "p50",
              "spaceAggregation": "p50",
              "filters": {
                "items": [],
                "op": "AND"
              },
              "expression": "A",
              "disabled": false,
              "legend": "p50",
              "stepInterval": 60
            },
            {
              "dataSource": "metrics",
              "queryName": "B",
              "aggregateOperator": "p95",
              "aggregateAttribute": {
                "key": "saga_duration",
                "type": "Histogram",
                "isColumn": true
              },
              "timeAggregation": "p95",
              "spaceAggregation": "p95",
              "filters": {
                "items": [],
                "op": "AND"
              },
              "expression": "B",
              "disabled": false,
              "legend": "p95",
              "stepInterval": 60
            },
            {
              "dataSource": "metrics",
              "queryName": "C",
              "aggregateOperator": "p99",
              "aggregateAttribute": {
                "key": "saga_duration",
                "type": "Histogram",
                "isColumn": true
              },
              "timeAggregation": "p99",
              "spaceAggregation": "p99",
              "filters": {
                "items": [],
                "op": "AND"
              },
              "expression": "C",
              "disabled": false,
              "legend": "p99",
              "stepInterval": 60
            }
          ],
          "queryFormulas": []
        }
      }
    },
    {
      "id": "step-duration",
      "title": "Step Duration by Step Name",
      "description": "Average duration of each saga step",
      "panelTypes": "graph",
      "opacity": "1",
      "isStacked": false,
      "nullZeroValues": "zero",
      "yAxisUnit": "ms",
      "timePreferance": "LAST_15_MIN",
      "query": {
        "queryType": "builder",
        "builder": {
          "queryData": [
            {
              "dataSource": "metrics",
              "queryName": "A",
              "aggregateOperator": "avg",
              "aggregateAttribute": {
                "key": "saga_step_duration",
                "type": "Histogram",
                "isColumn": true
              },
              "timeAggregation": "avg",
              "spaceAggregation": "avg",
              "filters": {
                "items": [],
                "op": "AND"
              },
              "groupBy": [
                {
                  "key": "step_name",
                  "type": "tag",
                  "isColumn": false
                }
              ],
              "expression": "A",
              "disabled": false,
              "legend": "{{step_name}}",
              "stepInterval": 60
            }
          ],
          "queryFormulas": []
        }
      }
    },
    {
      "id": "row-steps",
      "title": "Step Metrics",
      "description": "",
      "panelTypes": "row",
      "query": {}
    },
    {
      "id": "step-completed",
      "title": "Completed Steps by Name",
      "description": "Count of completed steps grouped by step name",
      "panelTypes": "graph",
      "opacity": "1",
      "isStacked": true,
      "nullZeroValues": "zero",
      "yAxisUnit": "short",
      "timePreferance": "LAST_15_MIN",
      "query": {
        "queryType": "builder",
        "builder": {
          "queryData": [
            {
              "dataSource": "metrics",
              "queryName": "A",
              "aggregateOperator": "rate",
              "aggregateAttribute": {
                "key": "saga_step_completed_total",
                "type": "Sum",
                "isColumn": true
              },
              "timeAggregation": "rate",
              "spaceAggregation": "sum",
              "filters": {
                "items": [],
                "op": "AND"
              },
              "groupBy": [
                {
                  "key": "step_name",
                  "type": "tag",
                  "isColumn": false
                }
              ],
              "expression": "A",
              "disabled": false,
              "legend": "{{step_name}}",
              "stepInterval": 60
            }
          ],
          "queryFormulas": []
        }
      }
    },
    {
      "id": "step-failed",
      "title": "Failed Steps by Name",
      "description": "Count of failed steps grouped by step name (indicates where sagas are failing)",
      "panelTypes": "graph",
      "opacity": "1",
      "isStacked": true,
      "nullZeroValues": "zero",
      "yAxisUnit": "short",
      "timePreferance": "LAST_15_MIN",
      "query": {
        "queryType": "builder",
        "builder": {
          "queryData": [
            {
              "dataSource": "metrics",
              "queryName": "A",
              "aggregateOperator": "rate",
              "aggregateAttribute": {
                "key": "saga_step_failed_total",
                "type": "Sum",
                "isColumn": true
              },
              "timeAggregation": "rate",
              "spaceAggregation": "sum",
              "filters": {
                "items": [],
                "op": "AND"
              },
              "groupBy": [
                {
                  "key": "step_name",
                  "type": "tag",
                  "isColumn": false
                }
              ],
              "expression": "A",
              "disabled": false,
              "legend": "{{step_name}}",
              "stepInterval": 60
            }
          ],
          "queryFormulas": []
        }
      }
    },
    {
      "id": "row-compensation",
      "title": "Compensation Metrics",
      "description": "",
      "panelTypes": "row",
      "query": {}
    },
    {
      "id": "compensation-executed",
      "title": "Compensation Actions by Step",
      "description": "Rate of compensation actions executed for each step",
      "panelTypes": "graph",
      "opacity": "1",
      "isStacked": true,
      "nullZeroValues": "zero",
      "yAxisUnit": "ops",
      "timePreferance": "LAST_15_MIN",
      "query": {
        "queryType": "builder",
        "builder": {
          "queryData": [
            {
              "dataSource": "metrics",
              "queryName": "A",
              "aggregateOperator": "rate",
              "aggregateAttribute": {
                "key": "saga_compensation_executed_total",
                "type": "Sum",
                "isColumn": true
              },
              "timeAggregation": "rate",
              "spaceAggregation": "sum",
              "filters": {
                "items": [],
                "op": "AND"
              },
              "groupBy": [
                {
                  "key": "step_name",
                  "type": "tag",
                  "isColumn": false
                }
              ],
              "expression": "A",
              "disabled": false,
              "legend": "{{step_name}}",
              "stepInterval": 60
            }
          ],
          "queryFormulas": []
        }
      }
    }
  ],
  "uploadedGrafana": false
}
