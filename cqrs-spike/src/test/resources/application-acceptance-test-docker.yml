# Application configuration for acceptance tests using Docker Compose
# Use this profile when running tests with docker-compose.acceptance-test.yml
# instead of Testcontainers.
#
# Usage:
#   docker-compose -f docker-compose.acceptance-test.yml up -d
#   ./gradlew test --tests "*AcceptanceTestRunner*" -Dspring.profiles.active=acceptance-test-docker

spring:
  application:
    name: cqrs-spike-acceptance-test-docker

  # R2DBC configuration for docker-compose postgres-test
  r2dbc:
    url: r2dbc:postgresql://localhost:5433/cqrs_test_db
    username: test_user
    password: test_password
    pool:
      enabled: true
      initial-size: 2
      max-size: 10

  # JDBC configuration for Flyway migrations
  datasource:
    url: jdbc:postgresql://localhost:5433/cqrs_test_db
    username: test_user
    password: test_password

  # Flyway configuration for schema migrations
  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true
    clean-disabled: false

  # Disable Vault for acceptance tests
  cloud:
    vault:
      enabled: false

# Logging configuration for acceptance tests
logging:
  level:
    root: WARN
    com.pintailconsultingllc.cqrsspike: INFO
    org.springframework.r2dbc: DEBUG
    io.cucumber: INFO

# Resilience4j configuration for acceptance tests
resilience4j:
  circuitbreaker:
    instances:
      productService:
        sliding-window-size: 5
        failure-rate-threshold: 50
        wait-duration-in-open-state: 1s
  retry:
    instances:
      productService:
        max-attempts: 2
        wait-duration: 100ms
  ratelimiter:
    instances:
      productService:
        limit-for-period: 100
        limit-refresh-period: 1s
