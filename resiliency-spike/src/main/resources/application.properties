spring.application.name=resiliency-spike

# Disable Vault health indicator to prevent startup issues
management.health.vault.enabled=false

# R2DBC PostgreSQL Configuration
# Values are populated from Vault at runtime (see bootstrap.properties)
spring.r2dbc.url=${url:r2dbc:postgresql://localhost:5432/resiliency_spike}
spring.r2dbc.username=${username:resiliency_user}
spring.r2dbc.password=${password:resiliency_password}

# Connection pool configuration
spring.r2dbc.pool.enabled=true
spring.r2dbc.pool.initial-size=${initial-size:10}
spring.r2dbc.pool.max-size=${max-size:20}
spring.r2dbc.pool.max-idle-time=30m

# Resilience4j Circuit Breaker Configuration
# Circuit breaker for shopping cart operations
resilience4j.circuitbreaker.instances.shoppingCart.registerHealthIndicator=true
resilience4j.circuitbreaker.instances.shoppingCart.slidingWindowSize=10
resilience4j.circuitbreaker.instances.shoppingCart.minimumNumberOfCalls=5
resilience4j.circuitbreaker.instances.shoppingCart.permittedNumberOfCallsInHalfOpenState=3
resilience4j.circuitbreaker.instances.shoppingCart.automaticTransitionFromOpenToHalfOpenEnabled=true
resilience4j.circuitbreaker.instances.shoppingCart.waitDurationInOpenState=5s
resilience4j.circuitbreaker.instances.shoppingCart.failureRateThreshold=50
resilience4j.circuitbreaker.instances.shoppingCart.slowCallRateThreshold=50
resilience4j.circuitbreaker.instances.shoppingCart.slowCallDurationThreshold=2s
resilience4j.circuitbreaker.instances.shoppingCart.recordExceptions[0]=java.lang.Exception

# Circuit breaker for cart item operations
resilience4j.circuitbreaker.instances.cartItem.registerHealthIndicator=true
resilience4j.circuitbreaker.instances.cartItem.slidingWindowSize=10
resilience4j.circuitbreaker.instances.cartItem.minimumNumberOfCalls=5
resilience4j.circuitbreaker.instances.cartItem.permittedNumberOfCallsInHalfOpenState=3
resilience4j.circuitbreaker.instances.cartItem.automaticTransitionFromOpenToHalfOpenEnabled=true
resilience4j.circuitbreaker.instances.cartItem.waitDurationInOpenState=5s
resilience4j.circuitbreaker.instances.cartItem.failureRateThreshold=50
resilience4j.circuitbreaker.instances.cartItem.slowCallRateThreshold=50
resilience4j.circuitbreaker.instances.cartItem.slowCallDurationThreshold=2s

# Circuit breaker for product operations
resilience4j.circuitbreaker.instances.product.registerHealthIndicator=true
resilience4j.circuitbreaker.instances.product.slidingWindowSize=10
resilience4j.circuitbreaker.instances.product.minimumNumberOfCalls=5
resilience4j.circuitbreaker.instances.product.permittedNumberOfCallsInHalfOpenState=3
resilience4j.circuitbreaker.instances.product.automaticTransitionFromOpenToHalfOpenEnabled=true
resilience4j.circuitbreaker.instances.product.waitDurationInOpenState=5s
resilience4j.circuitbreaker.instances.product.failureRateThreshold=50
resilience4j.circuitbreaker.instances.product.slowCallRateThreshold=50
resilience4j.circuitbreaker.instances.product.slowCallDurationThreshold=2s

# Circuit breaker for category operations
resilience4j.circuitbreaker.instances.category.registerHealthIndicator=true
resilience4j.circuitbreaker.instances.category.slidingWindowSize=10
resilience4j.circuitbreaker.instances.category.minimumNumberOfCalls=5
resilience4j.circuitbreaker.instances.category.permittedNumberOfCallsInHalfOpenState=3
resilience4j.circuitbreaker.instances.category.automaticTransitionFromOpenToHalfOpenEnabled=true
resilience4j.circuitbreaker.instances.category.waitDurationInOpenState=5s
resilience4j.circuitbreaker.instances.category.failureRateThreshold=50
resilience4j.circuitbreaker.instances.category.slowCallRateThreshold=50
resilience4j.circuitbreaker.instances.category.slowCallDurationThreshold=2s

# Resilience4j Retry Configuration
# Retry for shopping cart operations
resilience4j.retry.instances.shoppingCart.maxAttempts=3
resilience4j.retry.instances.shoppingCart.waitDuration=500ms
resilience4j.retry.instances.shoppingCart.enableExponentialBackoff=true
resilience4j.retry.instances.shoppingCart.exponentialBackoffMultiplier=2
resilience4j.retry.instances.shoppingCart.retryExceptions[0]=java.io.IOException
resilience4j.retry.instances.shoppingCart.retryExceptions[1]=java.util.concurrent.TimeoutException
resilience4j.retry.instances.shoppingCart.retryExceptions[2]=org.springframework.dao.TransientDataAccessException

# Retry for cart item operations
resilience4j.retry.instances.cartItem.maxAttempts=3
resilience4j.retry.instances.cartItem.waitDuration=500ms
resilience4j.retry.instances.cartItem.enableExponentialBackoff=true
resilience4j.retry.instances.cartItem.exponentialBackoffMultiplier=2
resilience4j.retry.instances.cartItem.retryExceptions[0]=java.io.IOException
resilience4j.retry.instances.cartItem.retryExceptions[1]=java.util.concurrent.TimeoutException
resilience4j.retry.instances.cartItem.retryExceptions[2]=org.springframework.dao.TransientDataAccessException

# Retry for product operations
resilience4j.retry.instances.product.maxAttempts=3
resilience4j.retry.instances.product.waitDuration=500ms
resilience4j.retry.instances.product.enableExponentialBackoff=true
resilience4j.retry.instances.product.exponentialBackoffMultiplier=2
resilience4j.retry.instances.product.retryExceptions[0]=java.io.IOException
resilience4j.retry.instances.product.retryExceptions[1]=java.util.concurrent.TimeoutException
resilience4j.retry.instances.product.retryExceptions[2]=org.springframework.dao.TransientDataAccessException

# Retry for category operations
resilience4j.retry.instances.category.maxAttempts=3
resilience4j.retry.instances.category.waitDuration=500ms
resilience4j.retry.instances.category.enableExponentialBackoff=true
resilience4j.retry.instances.category.exponentialBackoffMultiplier=2
resilience4j.retry.instances.category.retryExceptions[0]=java.io.IOException
resilience4j.retry.instances.category.retryExceptions[1]=java.util.concurrent.TimeoutException
resilience4j.retry.instances.category.retryExceptions[2]=org.springframework.dao.TransientDataAccessException

# Resilience4j Rate Limiter Configuration
# Rate limiter for shopping cart operations
resilience4j.ratelimiter.instances.shoppingCart.limitForPeriod=100
resilience4j.ratelimiter.instances.shoppingCart.limitRefreshPeriod=1s
resilience4j.ratelimiter.instances.shoppingCart.timeoutDuration=0s
resilience4j.ratelimiter.instances.shoppingCart.registerHealthIndicator=true
resilience4j.ratelimiter.instances.shoppingCart.eventConsumerBufferSize=100

# Rate limiter for cart item operations
resilience4j.ratelimiter.instances.cartItem.limitForPeriod=100
resilience4j.ratelimiter.instances.cartItem.limitRefreshPeriod=1s
resilience4j.ratelimiter.instances.cartItem.timeoutDuration=0s
resilience4j.ratelimiter.instances.cartItem.registerHealthIndicator=true
resilience4j.ratelimiter.instances.cartItem.eventConsumerBufferSize=100

# Rate limiter for product operations
resilience4j.ratelimiter.instances.product.limitForPeriod=100
resilience4j.ratelimiter.instances.product.limitRefreshPeriod=1s
resilience4j.ratelimiter.instances.product.timeoutDuration=0s
resilience4j.ratelimiter.instances.product.registerHealthIndicator=true
resilience4j.ratelimiter.instances.product.eventConsumerBufferSize=100

# Rate limiter for category operations
resilience4j.ratelimiter.instances.category.limitForPeriod=100
resilience4j.ratelimiter.instances.category.limitRefreshPeriod=1s
resilience4j.ratelimiter.instances.category.timeoutDuration=0s
resilience4j.ratelimiter.instances.category.registerHealthIndicator=true
resilience4j.ratelimiter.instances.category.eventConsumerBufferSize=100

# Spring Boot Actuator endpoints for monitoring circuit breakers, retries, and rate limiters
management.endpoints.web.exposure.include=health,info,metrics,circuitbreakers,circuitbreakerevents,retries,retryevents,ratelimiters,ratelimiterevents
management.endpoint.health.show-details=always
management.health.circuitbreakers.enabled=true
management.health.ratelimiters.enabled=true

# OpenAPI Documentation Configuration
springdoc.api-docs.path=/api-docs
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.enabled=true
springdoc.api-docs.enabled=true
springdoc.swagger-ui.operationsSorter=method
springdoc.swagger-ui.tagsSorter=alpha
springdoc.swagger-ui.tryItOutEnabled=true
springdoc.show-actuator=false

# OpenAPI Info
springdoc.info.title=Spring Boot Resiliency Spike Solution
springdoc.info.description=Spring Boot WebFlux API demonstrating resilience patterns with Circuit Breakers, Retries, and Rate Limiters
springdoc.info.version=0.0.1-SNAPSHOT
springdoc.info.contact.name=Pintail Consulting LLC
springdoc.info.contact.email=info@pintailconsultingllc.com

# OpenTelemetry Configuration
# Enable tracing with OpenTelemetry
management.tracing.enabled=true
management.tracing.sampling.probability=1.0

# OTLP Exporter Configuration
# Choose one of the following backends:
#
# Option 1: Jaeger (default)
management.otlp.tracing.endpoint=http://localhost:4318/v1/traces
#
# Option 2: SigNoz (uncomment to use SigNoz instead of Jaeger)
# management.otlp.tracing.endpoint=http://localhost:4320/v1/traces
#
# Option 3: Send to both (requires custom configuration - see SIGNOZ.md)

# OTLP compression
management.otlp.tracing.compression=gzip

# Propagation format (W3C Trace Context)
management.tracing.propagation.type=w3c

# Baggage propagation (optional - for custom context)
management.tracing.baggage.enabled=true
management.tracing.baggage.remote-fields=user-id,session-id

# Observability-related actuator endpoints
management.endpoints.web.exposure.include=health,info,metrics,circuitbreakers,circuitbreakerevents,retries,retryevents,ratelimiters,ratelimiterevents,prometheus

# Logging pattern with trace context
logging.pattern.level=%5p [${spring.application.name:},%X{traceId:-},%X{spanId:-}]

# Logging configuration
#logging.level.io.r2dbc.postgresql=DEBUG
#logging.level.io.r2dbc.postgresql.QUERY=DEBUG
#logging.level.io.r2dbc.postgresql.PARAM=DEBUG
#logging.level.org.springframework.boot=DEBUG
#logging.level.com.pintailconsultingllc.resiliencyspike=DEBUG
#logging.level.io.github.resilience4j=DEBUG
